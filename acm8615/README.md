# ACM8615 Driver - Linux (Device Tree)

## Overview

ACME Semiconductor audio amplifier driver for Linux SoC codecs.

This driver is only for `SoC` platform and requires `Device Tree` implements.

## Compiling
In source directory. Run:

    make

### Cross Compile
If you need cross compiling. For example, build `ARM` target on your `x86/x64` PC.

Modify `$KDIR` to your target Linux Kernel Source directory in `Makefile`

```makefile
KDIR := /lib/modules/$(shell uname -r)/build    # KDIR := [path-to-target-kernel-source] if cross compiling
```

then Run:

    make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-

`$ARCH`, `$CROSS_COMPILE` may various upon your cross compiler.

## Installation

Copy the output module `acm8615.ko` to target file system. Run:

    sudo insmod acm8615.ko

Check if module loaded successfully.

    lsmod


## Device Tree
Just add ACM8615 node as child of corresponding `i2c` device node. Usually named in `i2c0`, `i2c1`...

You should set `<reg>` correct `i2c` address. Default `0x34` or other address depend on Datasheet.

Example:
```dts
    i2c0 {
        #address-cells = <1>;
        #size-cells = <0>;
        acm8615: acm8615@34 {
            reg = <0x34>;
            compatible = "acme,acm8615";

            acme,dsp-config-name = "mono_pbtl_48khz";
        };
    };
```

## Firmware
The driver will load `DSP Settings` (EQ, AGL, DRC and etc.) to chip while driver activating.

You should put firmware `.bin` file generated by `ACME Audio Tuning` tool into Linux firmware directory, default `/lib/firmware`, and name it `acm8615_dsp_<user-defined>.bin`. Then set `acme,dsp-config-name` parameter to `<user-defined>`.

For example, the firmware file is named `acm8615_dsp_mono_pbtl_48khz.bin`. The `acme,dsp-config-name` in Device Tree file(`.dts`) will be set to `mono_pbtl_48khz` .

```dts
            acme,dsp-config-name = "mono_pbtl_48khz";
```
So that the driver could find correct firmware file.
